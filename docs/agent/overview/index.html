<!DOCTYPE html><html lang="zh-CN" data-astro-cid-usuvaegl> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Mastra ‰∏≠ÊñáÊñáÊ°£" href="https://fengjutian.github.io/rss.xml"><meta name="generator" content="Astro v5.14.1"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://fengjutian.github.io/mastra-zh-doc/docs/agent/overview/"><!-- Primary Meta Tags --><title>overview</title><meta name="title" content="overview"><meta name="description" content="Mastra ÊñáÊ°£‰∏≠ÂøÉ"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://fengjutian.github.io/mastra-zh-doc/docs/agent/overview/"><meta property="og:title" content="overview"><meta property="og:description" content="Mastra ÊñáÊ°£‰∏≠ÂøÉ"><meta property="og:image" content="https://fengjutian.github.io/mastra-zh-doc/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://fengjutian.github.io/mastra-zh-doc/docs/agent/overview/"><meta property="twitter:title" content="overview"><meta property="twitter:description" content="Mastra ÊñáÊ°£‰∏≠ÂøÉ"><meta property="twitter:image" content="https://fengjutian.github.io/mastra-zh-doc/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/mastra-zh-doc/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/mastra-zh-doc/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:linear-gradient(var(--gray-gradient)) no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:rgb(var(--gray-dark));font-size:20px;line-height:1.7}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2}h1{font-size:1.902em}h2{font-size:1.041em}h3{font-size:.653em}h4{font-size:.363em}h5{font-size:.05em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:.833em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:#fff;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}
main[data-astro-cid-usuvaegl]{width:1620px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}.docs-layout[data-astro-cid-usuvaegl]{display:flex;gap:2rem;max-width:1400px;margin:auto;padding:1em 1em 3em}.content-container[data-astro-cid-usuvaegl]{display:flex;gap:2rem;flex:1}.sidebar[data-astro-cid-usuvaegl]{width:280px;flex-shrink:0;position:sticky;top:2rem;max-height:calc(100vh - 4rem);overflow-y:auto;padding-right:1rem;font-size:.9rem}.sidebar[data-astro-cid-usuvaegl] h2[data-astro-cid-usuvaegl]{margin-bottom:1rem;color:rgb(var(--black));font-size:1.5em}.sidebar[data-astro-cid-usuvaegl] h3[data-astro-cid-usuvaegl]{margin:1.5rem 0 .75rem;color:rgb(var(--gray));font-weight:500;font-size:1.1em}.sidebar[data-astro-cid-usuvaegl] ul[data-astro-cid-usuvaegl]{list-style:none;padding:0;margin:0}.sidebar[data-astro-cid-usuvaegl] li[data-astro-cid-usuvaegl]{margin:.35rem 0}.sidebar[data-astro-cid-usuvaegl] a[data-astro-cid-usuvaegl]{display:block;padding:.5rem;color:rgb(var(--gray-dark));text-decoration:none;border-radius:.375rem;transition:background-color .2s}.sidebar[data-astro-cid-usuvaegl] a[data-astro-cid-usuvaegl]:hover{background-color:rgba(var(--gray-light),70%)}.sidebar[data-astro-cid-usuvaegl] a[data-astro-cid-usuvaegl].active{background-color:#2337ff1a;color:var(--accent);font-weight:500}.content[data-astro-cid-usuvaegl]{flex:1;max-width:1200px}.right-sidebar[data-astro-cid-usuvaegl]{width:280px;flex-shrink:0;position:sticky;top:2rem;max-height:calc(100vh - 4rem);overflow-y:auto;padding-left:1rem;border-left:1px solid rgba(var(--gray-light),100%);font-size:.9rem}.right-sidebar[data-astro-cid-usuvaegl] h3[data-astro-cid-usuvaegl]{margin-top:0;margin-bottom:1rem;color:rgb(var(--black));font-size:1.1em}.toc-list[data-astro-cid-usuvaegl]{list-style:none;padding:0;margin:0}.toc-list[data-astro-cid-usuvaegl] li[data-astro-cid-usuvaegl]{margin:.35rem 0}.toc-list[data-astro-cid-usuvaegl] a[data-astro-cid-usuvaegl]{display:block;padding:.35rem 0;color:rgb(var(--gray-dark));text-decoration:none;transition:color .2s}.toc-list[data-astro-cid-usuvaegl] a[data-astro-cid-usuvaegl]:hover{color:var(--accent)}.toc-item-h2[data-astro-cid-usuvaegl]{margin-left:0}.toc-item-h3[data-astro-cid-usuvaegl]{margin-left:1rem;font-size:.95em}.toc-item-h4[data-astro-cid-usuvaegl]{margin-left:2rem;font-size:.9em}.content[data-astro-cid-usuvaegl] .description[data-astro-cid-usuvaegl]{margin-bottom:2em;color:rgb(var(--gray))}@media (max-width: 1024px){.sidebar[data-astro-cid-usuvaegl]{width:240px}}@media (max-width: 1200px){.right-sidebar[data-astro-cid-usuvaegl]{width:240px}}@media (max-width: 1024px){.sidebar[data-astro-cid-usuvaegl]{width:240px}.content-container[data-astro-cid-usuvaegl]{flex-direction:column}.right-sidebar[data-astro-cid-usuvaegl]{width:100%;position:static;max-height:none;overflow-y:visible;padding-left:0;border-left:none;border-top:1px solid rgba(var(--gray-light),100%);padding-top:1rem;margin-top:1rem}}@media (max-width: 768px){.docs-layout[data-astro-cid-usuvaegl]{flex-direction:column;gap:1rem}.sidebar[data-astro-cid-usuvaegl]{width:100%;position:static;max-height:none;overflow-y:visible;padding-right:0;margin-bottom:1rem}}
a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
</style></head> <body data-astro-cid-usuvaegl> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Mastra ‰∏≠ÊñáÊñáÊ°£</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a>  <a href="/docs" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Docs </a>  <a href="/blog" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/about" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> About </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://m.webtoo.ls/@astro" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Astro on Mastodon</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://twitter.com/astrodotbuild" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Astro on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://github.com/withastro/astro" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Astro's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> </div> </nav> </header>  <main data-astro-cid-usuvaegl> <div class="docs-layout" data-astro-cid-usuvaegl> <!-- Â∑¶‰æßÊñáÊ°£ÂØºËà™ --> <div class="sidebar" data-astro-cid-usuvaegl> <h2 style="margin-top: 0;" data-astro-cid-usuvaegl>Mastra ÊñáÊ°£ÁõÆÂΩï</h2> <div data-astro-cid-usuvaegl> <h3 data-astro-cid-usuvaegl>Mastra</h3> <ul data-astro-cid-usuvaegl> <li data-astro-cid-usuvaegl> <a href="/docs/mastra/mastra-getting-started" class data-astro-cid-usuvaegl> ÁÆÄ‰ªã | Mastra ÊñáÊ°£ </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/mastra/mastra-project-structure" class data-astro-cid-usuvaegl> È°πÁõÆÁªìÊûÑ </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/mastra/mcp-docs-server" class data-astro-cid-usuvaegl> Mastra MCP ÊñáÊ°£ÊúçÂä°Âô® </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/mastra/model-providers" class data-astro-cid-usuvaegl> Ê®°ÂûãÊèê‰æõËÄÖÔºàModel ProvidersÔºâ </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/mastra/model-capability" class data-astro-cid-usuvaegl> Ê®°ÂûãËÉΩÂäõÔºàModel CapabilitiesÔºâ </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/mastra/templates" class data-astro-cid-usuvaegl>  Ê®°ÊùøÔºàTemplatesÔºâ </a> </li> </ul> </div><div data-astro-cid-usuvaegl> <h3 data-astro-cid-usuvaegl>ÈÉ®ÁΩ≤</h3> <ul data-astro-cid-usuvaegl> <li data-astro-cid-usuvaegl> <a href="/docs/deployment-overview" class data-astro-cid-usuvaegl> ÈÉ®ÁΩ≤Ê¶ÇËø∞ </a> </li> </ul> </div><div data-astro-cid-usuvaegl> <h3 data-astro-cid-usuvaegl>Â∑•‰ΩúÊµÅ</h3> <ul data-astro-cid-usuvaegl> <li data-astro-cid-usuvaegl> <a href="/docs/workflows-overview" class data-astro-cid-usuvaegl> Â∑•‰ΩúÊµÅÊ¶ÇËø∞ </a> </li> </ul> </div><div data-astro-cid-usuvaegl> <h3 data-astro-cid-usuvaegl>Êô∫ËÉΩ‰Ωì</h3> <ul data-astro-cid-usuvaegl> <li data-astro-cid-usuvaegl> <a href="/docs/agents-overview" class data-astro-cid-usuvaegl> Êô∫ËÉΩ‰ΩìÊ¶ÇËø∞ </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/adding-voice" class data-astro-cid-usuvaegl> ‰∏∫Êô∫ËÉΩ‰ΩìÊ∑ªÂä†ËØ≠Èü≥ÂäüËÉΩ </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/agent-memory" class data-astro-cid-usuvaegl> Using Agent Memory | Agents | Mastra Docs </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/dynamic-agents" class data-astro-cid-usuvaegl> Dynamic Agents </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/output-processors" class data-astro-cid-usuvaegl> Output Processors </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/input-processors" class data-astro-cid-usuvaegl> Input Processors </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/overview" class="active" data-astro-cid-usuvaegl> overview </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/using-tools-and-mcp" class data-astro-cid-usuvaegl> Using Tools with Agents | Agents | Mastra Docs </a> </li><li data-astro-cid-usuvaegl> <a href="/docs/agent/runtime-context" class data-astro-cid-usuvaegl> Runtime context | Agents | Mastra Docs </a> </li> </ul> </div><div data-astro-cid-usuvaegl> <h3 data-astro-cid-usuvaegl>RAG</h3> <ul data-astro-cid-usuvaegl> <li data-astro-cid-usuvaegl> <a href="/docs/rag-overview" class data-astro-cid-usuvaegl> Ê£ÄÁ¥¢Â¢ûÂº∫ÁîüÊàê(RAG)Ê¶ÇËø∞ </a> </li> </ul> </div>  </div> <!-- ÂÜÖÂÆπÂíåÂè≥‰æßÁõÆÂΩïÂÆπÂô® --> <div class="content-container" data-astro-cid-usuvaegl> <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü --> <div class="content" data-astro-cid-usuvaegl> <article data-astro-cid-usuvaegl> <h1 data-astro-cid-usuvaegl>overview</h1> <p class="description" style="color: #666; font-size: 1.125rem; margin-bottom: 2rem;" data-astro-cid-usuvaegl>  </p> <pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>import { Steps } from &quot;nextra/components&quot;;</span></span></code></pre>
<h1 id="using-agents">Using Agents</h1>
<p>Agents let you build intelligent assistants powered by language models that can make decisions and perform actions. Each agent has required instructions and an LLM, with optional tools and memory.</p>
<p>An agent coordinates conversations, calls tools when needed, maintains context through memory, and produces responses tailored to the interaction. Agents can operate on their own or work as part of larger workflows.</p>
<p><img src="/image/agents/agents-overview.jpg" alt="Agents overview"/></p>
<p>To create an agent:</p>
<ul>
<li>Define <strong>instructions</strong> with the <code>Agent</code> class and set the <strong>LLM</strong> it will use.</li>
<li>Optionally configure <strong>tools</strong> and <strong>memory</strong> to extend functionality.</li>
<li>Run the agent to generate responses, with support for streaming, structured output, and dynamic configuration.</li>
</ul>
<p>This approach provides type safety and runtime validation, ensuring reliable behavior across all agent interactions.</p>
<blockquote>
<p><strong>üìπ Watch</strong>:  ‚Üí An introduction to agents, and how they compare to workflows <a href="https://youtu.be/0jg2g3sNvgw">YouTube (7 minutes)</a></p>
</blockquote>
<h2 id="getting-started">Getting started</h2>
<p>To use agents, install the required dependencies:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> @mastra/core</span><span style="color:#9ECBFF"> @ai-sdk/openai</span></span></code></pre>
<blockquote>
<p>Mastra works with all AI SDK provider. See <a href="../getting-started/model-providers.mdx">Model Providers</a> for more information.</p>
</blockquote>
<p>Import the necessary class from the agents module, and an LLM provider:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { openai } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;@ai-sdk/openai&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { Agent } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;@mastra/core/agent&quot;</span><span style="color:#E1E4E8">;</span></span></code></pre>
<h3 id="llm-providers">LLM providers</h3>
<p>Each LLM provider needs its own API key, named using the provider‚Äôs identifier:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#E1E4E8">OPENAI_API_KEY</span><span style="color:#F97583">=&lt;</span><span style="color:#9ECBFF">your-api-key</span><span style="color:#F97583">&gt;</span></span></code></pre>
<blockquote>
<p>See the <a href="https://ai-sdk.dev/providers/ai-sdk-providers">AI SDK Providers</a> in the Vercel AI SDK docs.</p>
</blockquote>
<h3 id="creating-an-agent">Creating an agent</h3>
<p>To create an agent in Mastra, use the <code>Agent</code> class. Every agent must include <code>instructions</code> to define its behavior, and a <code>model</code> parameter to specify the LLM provider and model:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { openai } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;@ai-sdk/openai&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { Agent } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;@mastra/core/agent&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> testAgent</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Agent</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  name: </span><span style="color:#9ECBFF">&quot;test-agent&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  instructions: </span><span style="color:#9ECBFF">&quot;You are a helpful assistant.&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  model: </span><span style="color:#B392F0">openai</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;gpt-4o-mini&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h4 id="instruction-formats">Instruction formats</h4>
<p>Instructions define the agent‚Äôs behavior, personality, and capabilities.
They are system-level prompts that establish the agent‚Äôs core identity and expertise.</p>
<p>Instructions can be provided in multiple formats for greater flexibility:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#6A737D">// String (most common)</span></span>
<span class="line"><span style="color:#B392F0">instructions</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;You are a helpful assistant.&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// System message object</span></span>
<span class="line"><span style="color:#B392F0">instructions</span><span style="color:#E1E4E8">: { </span></span>
<span class="line"><span style="color:#B392F0">  role</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;system&quot;</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#B392F0">  content</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;You are an expert programmer.&quot;</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Array of strings</span></span>
<span class="line"><span style="color:#B392F0">instructions</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;You are a helpful assistant.&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;Always be polite.&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  &quot;Provide detailed answers.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Array of system messages</span></span>
<span class="line"><span style="color:#B392F0">instructions</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;system&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;You are a helpful assistant.&quot;</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;system&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;You have expertise in TypeScript.&quot;</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// With provider-specific options (e.g., caching, reasoning)</span></span>
<span class="line"><span style="color:#B392F0">instructions</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#B392F0">  role</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;system&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B392F0">  content</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;You are an expert code reviewer. Analyze code for bugs, performance issues, and best practices.&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B392F0">  providerOptions</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#B392F0">    openai</span><span style="color:#E1E4E8">: { </span><span style="color:#B392F0">reasoning_effort</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;high&quot;</span><span style="color:#E1E4E8"> },        </span><span style="color:#6A737D">// OpenAI&#39;s reasoning models</span></span>
<span class="line"><span style="color:#B392F0">    anthropic</span><span style="color:#E1E4E8">: { </span><span style="color:#B392F0">cache_control</span><span style="color:#E1E4E8">: { </span><span style="color:#B392F0">type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;ephemeral&quot;</span><span style="color:#E1E4E8"> } }  </span><span style="color:#6A737D">// Anthropic&#39;s prompt caching</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Provider-specific options allow you to leverage unique features of different LLM providers:</p>
<ul>
<li><strong>Anthropic caching</strong>: Reduce costs by caching frequently-used instructions</li>
<li><strong>OpenAI reasoning</strong>: Enable deeper analysis for complex tasks</li>
<li><strong>Custom parameters</strong>: Pass any provider-specific configuration</li>
</ul>
<blockquote>
<p>See <a href="../../reference/agents/agent.mdx">Agent</a> for more information.</p>
</blockquote>
<h3 id="registering-an-agent">Registering an agent</h3>
<p>Register your agent in the Mastra instance:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { Mastra } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;@mastra/core/mastra&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { testAgent } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &#39;./agents/test-agent&#39;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> mastra</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Mastra</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8">  agents: { testAgent },</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="referencing-an-agent">Referencing an agent</h2>
<p>You can call agents from workflow steps, tools, the Mastra Client, or the command line. Get a reference by calling <code>.getAgent()</code> on your <code>mastra</code> or <code>mastraClient</code> instance, depending on your setup:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> testAgent</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> mastra.</span><span style="color:#B392F0">getAgent</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;testAgent&quot;</span><span style="color:#E1E4E8">);</span></span></code></pre>
<blockquote>
<p>See <a href="../../examples/agents/calling-agents.mdx">Calling agents</a> for more information.</p>
</blockquote>
<h2 id="generating-responses">Generating responses</h2>
<p>Use <code>.generate()</code> to get a response from an agent. Pass a single string for simple prompts, an array of strings when providing multiple pieces of context, or an array of message objects with <code>role</code> and <code>content</code> for precise control over roles and conversational flows.</p>
<blockquote>
<p>See <a href="../../reference/agents/generate.mdx">.generate()</a> for more information.</p>
</blockquote>
<h3 id="generating-text">Generating text</h3>
<p>Call <code>.generate()</code> with an array of message objects that include <code>role</code> and <code>content</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">generate</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;Help me organize my day&quot;</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;My day starts at 9am and finishes at 5.30pm&quot;</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;I take lunch between 12:30 and 13:30&quot;</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;I have meetings Monday to Friday between 10:30 and 11:30&quot;</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(response.text);</span></span></code></pre>
<h2 id="streaming-responses">Streaming responses</h2>
<p>Use <code>.stream()</code> for real-time responses. Pass a single string for simple prompts, an array of strings when providing multiple pieces of context, or an array of message objects with <code>role</code> and <code>content</code> for precise control over roles and conversational flows.</p>
<blockquote>
<p>See <a href="../../reference/agents/stream.mdx">.stream()</a> for more information.</p>
</blockquote>
<h3 id="streaming-text">Streaming text</h3>
<p>Use <code>.stream()</code> with an array of message objects that include <code>role</code> and <code>content</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> stream</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">stream</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;Help me organize my day&quot;</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;My day starts at 9am and finishes at 5.30pm&quot;</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;I take lunch between 12:30 and 13:30&quot;</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">  { role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">, content: </span><span style="color:#9ECBFF">&quot;I have meetings Monday to Friday between 10:30 and 11:30&quot;</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> chunk</span><span style="color:#F97583"> of</span><span style="color:#E1E4E8"> stream.textStream) {</span></span>
<span class="line"><span style="color:#E1E4E8">  process.stdout.</span><span style="color:#B392F0">write</span><span style="color:#E1E4E8">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="completion-using-onfinish">Completion using <code>onFinish()</code></h3>
<p>When streaming responses, the <code>onFinish()</code> callback runs after the LLM finishes generating its response and all tool executions are complete.
It provides the final <code>text</code>, execution <code>steps</code>, <code>finishReason</code>, token <code>usage</code> statistics, and other metadata useful for monitoring or logging.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> stream</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">stream</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Help me organize my day&quot;</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#B392F0">  onFinish</span><span style="color:#E1E4E8">: ({ </span><span style="color:#FFAB70">steps</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">text</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">finishReason</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">usage</span><span style="color:#E1E4E8"> }) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">({ steps, text, finishReason, usage });</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#79B8FF"> chunk</span><span style="color:#F97583"> of</span><span style="color:#E1E4E8"> stream.textStream) {</span></span>
<span class="line"><span style="color:#E1E4E8">  process.stdout.</span><span style="color:#B392F0">write</span><span style="color:#E1E4E8">(chunk);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="structured-output">Structured output</h2>
<p>Agents can return structured, type-safe data by defining the expected output with either <a href="https://zod.dev/">Zod</a> or <a href="https://json-schema.org/">JSON Schema</a>. In both cases, the parsed result is available on <code>response.object</code>, allowing you to work directly with validated and typed data.</p>
<h3 id="using-zod">Using Zod</h3>
<p>Define the <code>output</code> shape using <a href="https://zod.dev/">Zod</a>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { z } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;zod&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">generate</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">  [</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#E1E4E8">      role: </span><span style="color:#9ECBFF">&quot;system&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      content: </span><span style="color:#9ECBFF">&quot;Provide a summary and keywords for the following text:&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#E1E4E8">      role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      content: </span><span style="color:#9ECBFF">&quot;Monkey, Ice Cream, Boat&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    output: z.</span><span style="color:#B392F0">object</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">      summary: z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">      keywords: z.</span><span style="color:#B392F0">array</span><span style="color:#E1E4E8">(z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(response.object);</span></span></code></pre>
<h4 id="agents-with-tools">Agents with tools</h4>
<p>To generate structured output with agents that use tools, use the <code>experimental_output</code> property:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { z } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;zod&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">generate</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    experimental_output: z.</span><span style="color:#B392F0">object</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">      summary: z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">      keywords: z.</span><span style="color:#B392F0">array</span><span style="color:#E1E4E8">(z.</span><span style="color:#B392F0">string</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(response.object);</span></span></code></pre>
<h2 id="describing-images">Describing images</h2>
<p>Agents can analyze and describe images by processing both the visual content and any text within them. To enable image analysis, pass an object with <code>type: &#39;image&#39;</code> and the image URL in the <code>content</code> array. You can combine image content with text prompts to guide the agent‚Äôs analysis.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">generate</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#E1E4E8">    role: </span><span style="color:#9ECBFF">&quot;user&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    content: [</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span></span>
<span class="line"><span style="color:#E1E4E8">        type: </span><span style="color:#9ECBFF">&quot;image&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        image: </span><span style="color:#9ECBFF">&quot;https://placebear.com/cache/395-205.jpg&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        mimeType: </span><span style="color:#9ECBFF">&quot;image/jpeg&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span></span>
<span class="line"><span style="color:#E1E4E8">        type: </span><span style="color:#9ECBFF">&quot;text&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        text: </span><span style="color:#9ECBFF">&quot;Describe the image in detail, and extract all the text in the image.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(response.text);</span></span></code></pre>
<h2 id="multi-step-tool-use">Multi-step tool use</h2>
<p>Agents can be enhanced with tools, functions that extend their capabilities beyond text generation. Tools allow agents to perform calculations, access external systems, and process data. Agents not only decide whether to call tools they‚Äôre given, they determine the parameters that should be given to that tool.</p>
<p>For a detailed guide to creating and configuring tools, see the <a href="../tools-mcp/overview.mdx">Tools Overview</a> page.</p>
<h3 id="using-maxsteps">Using <code>maxSteps</code></h3>
<p>The <code>maxSteps</code> parameter controls the maximum number of sequential LLM calls an agent can make, particularly important when using tool calls. By default, it is set to 1 to prevent infinite loops in case of misconfigured tools:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">generate</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Help me organize my day&quot;</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#E1E4E8">  maxSteps: </span><span style="color:#79B8FF">5</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(response.text);</span></span></code></pre>
<h3 id="using-onstepfinish">Using <code>onStepFinish</code></h3>
<p>You can monitor the progress of multi-step operations using the <code>onStepFinish</code> callback. This is useful for debugging or providing progress updates to users.</p>
<p><code>onStepFinish</code> is only available when streaming or generating text without structured output.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> testAgent.</span><span style="color:#B392F0">generate</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Help me organize my day&quot;</span><span style="color:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#B392F0">  onStepFinish</span><span style="color:#E1E4E8">: ({ </span><span style="color:#FFAB70">text</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">toolCalls</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">toolResults</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">finishReason</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">usage</span><span style="color:#E1E4E8"> }) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">({ text, toolCalls, toolResults, finishReason, usage });</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="testing-agents-locally">Testing agents locally</h2>
<p>There are two ways to run and test agents.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#B392F0">Steps</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<h3 id="mastra-playground">Mastra Playground</h3>
<p>With the Mastra Dev Server running you can test an agent from the Mastra Playground by visiting <a href="http://localhost:4111/agents">http://localhost:4111/agents</a> in your browser.</p>
<blockquote>
<p>For more information, see the <a href="/docs/server-db/local-dev-playground">Local Dev Playground</a> documentation.</p>
</blockquote>
<h3 id="command-line">Command line</h3>
<p>Create an agent response using <code>.generate()</code> or <code>.stream()</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> &quot;dotenv/config&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { mastra } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> &quot;./mastra&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> agent</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> mastra.</span><span style="color:#B392F0">getAgent</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;testAgent&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> agent.</span><span style="color:#B392F0">generate</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Help me organize my day&quot;</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(response.text);</span></span></code></pre>
<blockquote>
<p>See <a href="../../reference/agents/generate.mdx">.generate()</a> or <a href="../../reference/agents/stream.mdx">.stream()</a> for more information.</p>
</blockquote>
<p>To test this agent, run the following:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> tsx</span><span style="color:#9ECBFF"> src/test-agent.ts</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>&lt;/Steps&gt;</span></span></code></pre>
<h2 id="related">Related</h2>
<ul>
<li><a href="./agent-memory.mdx">Agent Memory</a></li>
<li><a href="./dynamic-agents.mdx">Dynamic Agents</a></li>
<li><a href="./using-tools-and-mcp.mdx">Agent Tools and MCP</a></li>
<li><a href="../../examples/agents/calling-agents.mdx">Calling Agents</a></li>
</ul> </article> </div> </div> <!-- Âè≥‰æßÊñáÊ°£ÂÜÖÁõÆÂΩï --> <div class="right-sidebar" data-astro-cid-usuvaegl> <h3 data-astro-cid-usuvaegl>ÊñáÊ°£ÁõÆÂΩï</h3> <ul class="toc-list" data-astro-cid-usuvaegl> <li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#getting-started" data-astro-cid-usuvaegl>Getting started</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#llm-providers" data-astro-cid-usuvaegl>LLM providers</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#creating-an-agent" data-astro-cid-usuvaegl>Creating an agent</a> </li><li class="toc-item-h4" data-astro-cid-usuvaegl> <a href="#instruction-formats" data-astro-cid-usuvaegl>Instruction formats</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#registering-an-agent" data-astro-cid-usuvaegl>Registering an agent</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#referencing-an-agent" data-astro-cid-usuvaegl>Referencing an agent</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#generating-responses" data-astro-cid-usuvaegl>Generating responses</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#generating-text" data-astro-cid-usuvaegl>Generating text</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#streaming-responses" data-astro-cid-usuvaegl>Streaming responses</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#streaming-text" data-astro-cid-usuvaegl>Streaming text</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#completion-using-onfinish" data-astro-cid-usuvaegl>Completion using onFinish()</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#structured-output" data-astro-cid-usuvaegl>Structured output</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#using-zod" data-astro-cid-usuvaegl>Using Zod</a> </li><li class="toc-item-h4" data-astro-cid-usuvaegl> <a href="#agents-with-tools" data-astro-cid-usuvaegl>Agents with tools</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#describing-images" data-astro-cid-usuvaegl>Describing images</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#multi-step-tool-use" data-astro-cid-usuvaegl>Multi-step tool use</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#using-maxsteps" data-astro-cid-usuvaegl>Using maxSteps</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#using-onstepfinish" data-astro-cid-usuvaegl>Using onStepFinish</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#testing-agents-locally" data-astro-cid-usuvaegl>Testing agents locally</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#mastra-playground" data-astro-cid-usuvaegl>Mastra Playground</a> </li><li class="toc-item-h3" data-astro-cid-usuvaegl> <a href="#command-line" data-astro-cid-usuvaegl>Command line</a> </li><li class="toc-item-h2" data-astro-cid-usuvaegl> <a href="#related" data-astro-cid-usuvaegl>Related</a> </li> </ul> </div> </div> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 Your name here. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://m.webtoo.ls/@astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Mastodon</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/mastodon" data-astro-cid-sz7xmlte><path fill="currentColor" d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://twitter.com/astrodotbuild" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/withastro/astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Astro's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>